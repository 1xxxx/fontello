var Fontomas = (function (_, Fontomas) {
  "use strict";

  var cfg, env, debug;

  cfg = {
    templates: {
      icon_size:          "#fm-icon-size-template",
      use_embedded:       "#fm-use-embedded-template",
      font_item:          "#fm-font-item-template",
      glyph_item:         "#fm-glyph-item-template",
      genfont_glyph_item: "#fm-genfont-glyph-item-template"
    },

    // class icon_size_prefix+"-<num>" added when icon size has changed
    icon_size_prefix:   "fm-icon-size-",
    icon_size_classes:  "", // precalculated by initCfg()

    preview_icon_sizes: [32, 24, 16],
    live_update:        true,
    fix_edges:          true,
    scale_precision:    6, // truncate the mantissa when scaling svg paths

    draggable_options: {
      revert:     "invalid",
      cursor:     "move",
      helper:     "clone",
      opacity:    0.5,
      disabled:   false
    },
    droppable_options: {
      hoverClass: "fm-drop-hover",
      tolerance:  "pointer"
    },
    path_options: {
      "fill":         "#000",
      "stroke":       "#000",
      "stroke-width": 0
    },
    output: {
      filename:     "fontomas.svg",
      font_id:      "FontomasCustom",
      horiz_adv_x:  500,
      units_per_em: 1000,
      ascent:       750,
      descent:      -250,
      metadata:     "This is a custom SVG font generated by Fontomas",
      missing_glyph_horiz_adv_x: 500
    }
  };

  // environment
  env = {
    is_file_proto:  (window.location.protocol === "file:"),
    filereader:     null
  };

  debug = {is_on: false};

  // init icon_size_classes
  cfg.icon_size_classes = cfg.preview_icon_sizes.map(function (item) {
    return cfg.icon_size_prefix+item;
  }).join(" ");

  // usage: index.html#debug:maxglyphs=10,noembedded,nofilereader
  _.each(window.location.hash.substr(1).split("&"), function (str) {
    var vars = str.split(":");

    if ("debug" === vars.shift()) {
      debug.is_on = true;
      _.each(vars.shift().split(","), function (str) {
        var pair = str.split("=");
        debug[pair[0]] = pair[1] && pair[1] !== "" ? pair[1] : true;
      });
    }
  });

  // public interface
  return $.extend(true, Fontomas, {
    cfg:          cfg,
    env:          env,
    debug:        debug,
    models:       {},
    views:        {}
  });
}(window._, Fontomas || {}));
